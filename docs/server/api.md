# API

Server implementations should follow the following format:

- `/`
    - responds with a json object containing information about the server structure. Example below.
- `/common`
    - Common endpoints
    - `/playground`
        - Endpoint for using a [GraphQL Playground](https://github.com/graphql/graphql-playground) that interacts with the latest version of graphql-supporting api version in a collaborated implementation
- `/v([0-9]*)`
    - 404
    - `/graphql`
        - Endpoint that accepts normal graphql post requests
    - `/socket`
        - Subscription root
        - This doesn't need to be implemented however if it isn't, subscriptions needs to be manually disabled as an option in the interact client's constructor
        - `/websocket`
            - Websocket for normal graphql subscription stuff
    
## Structure json example

```json
  {
  "common": {
    "playground": "/playground"
  },
  "v1": {
    "api": "/v1/graphql",
    "socket": "/v1/socket/websocket"
  }
}
```

the playground field may also be in each version of api and the common property may not exist.

[See this as an Elixir Phoenix controller](/packages/server/lib/api_web/controllers/APIController.ex)

v1 is just an example, can be any version.

## GraphQL

See the schema [here](/schema.graphql) (auto generated by IDEA based on official implementations)

### Authentication

Authentication is simple;

First, you have to make a GraphQL query with the authenticate type which will give you an access token and refresh token. 

Once you have done this, future requests must be sent with the header `CAPP_AUTH` which should have the value `ACCESS <accesstoken>`

If you are authenticating with a bot user, you can skip the first step and set the value of `CAPP_AUTH` to `TOKEN <bottoken>`

(These headers also work as connection params in a subscription)
