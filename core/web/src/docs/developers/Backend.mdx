import {Meta} from "@storybook/addon-docs/blocks";

<Meta title="Developers/Admins/Backend"/>

# Backend
The backend of collaborated was built to mostly manage its self. It should be very rare for it to fail. Anything that can fail is caught and the origin is made aware of the fault.

## Setting Up
The backend is pretty easy to set up.

### Before you start
Before you start there are a few things you will need. Here is a list of them:
 - Master postgres database for app storage
 - Backup postgres database for backing up app storage
 - MongoDB (or any nosql db) cluster for image storage
 - Master redis server
 - A new redis server for each location that will be hosted
    - Example: if you are hosting 1 capp instance in the uk and one in the us, you will need 2 redis servers as well as the master one.
 - All of collaborated's code unpacked and hash-checked (the installer should do this for you).

### Configuration
Collaborated's configuration is straight forward. A lot of its internal configuration is automatically set based on its current state and what is going on around it.
Databases will need to be inputted manually. In the core/server/data folder you should see a series of .ini files (the design choice behind this is because .ini files can be easily read and written by both nodejs/typescript and golang services)
In these files you will see the default information. (If the files don't exist you will need to run capp once but you dont need to stop it because it will crash lol)
They are pretty self explanatory so just input your database/redis and certificate secrets (the cert secrets can be set to random if you want peak security, this will make certificates regenerate every 10 minutes and sent via an encrypted ssh tunnel to wherever your databases are being hosted provided you set ssh details and cert secrets)

Once you have configured a capp instance, it will connect to the databases and construct tables if it hasn't already and notify the redis servers it is in master mode. if it is in slave mode it will connect to the databases in read only mode and connect to the redis servers in slave mode.

### Running
Running capp is straight forward. Shipped with the versions there should be pre-built runner executables which will do each of the following in that order:
1. clean-up data folders (but will not touch configs)
2. make sure all dependencies are installed (but clean them out if they already are installed)
3. test database and redis connections
4. start services
5. start collaborated and pass pids for the services

